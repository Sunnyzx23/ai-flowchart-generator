
> ai-flowchart-backend@1.0.0 start
> node server.js

[dotenv@17.2.1] injecting env (11) from .env -- tip: 📡 auto-backup env with Radar: https://dotenvx.com/radar
[AI Service] 加载Prompt配置成功，版本: 2.0
[Analysis Session] 启动会话清理定时器
[dotenv@17.2.1] injecting env (0) from .env -- tip: 📡 observe env with Radar: https://dotenvx.com/radar
🚀 服务器已启动: http://localhost:3001
📝 环境: development
🔗 前端地址: http://localhost:5173
📊 健康检查: http://localhost:3001/health
📨 GET /health - 2025-08-15T10:20:30.436Z
::1 - - [15/Aug/2025:10:20:30 +0000] "GET /health HTTP/1.1" 200 100 "-" "curl/8.6.0"
📤 GET /health 🟢 200 - 8ms
📨 POST /api/ai/analyze - 2025-08-15T10:20:38.780Z
[AI Controller] 开始分析需求: {
  requirement: '测试错误处理，这个请求应该会因为网络问题失败...',
  productType: 'web',
  implementType: 'ai',
  source: 'text'
}
[AI Service] 开始流程图分析: {
  requirement: '测试错误处理，这个请求应该会因为网络问题失败...',
  productType: 'web',
  implementType: 'ai'
}
[AI Service] Prompt组装完成，长度: 834
[Error Retry Service] 执行尝试 1/4
[AI Service] 发起AI调用: {"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\n\n【用户需求】：测试错误处理，这个请求应该会因为网络问题失败\n【产品类型】：...
::1 - - [15/Aug/2025:10:20:58 +0000] "POST /api/ai/analyze HTTP/1.1" - - "-" "curl/8.6.0"
[AI Service] AI调用失败: aborted
[Error Retry Service] 错误记录: {
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium',
  timestamp: '2025-08-15T10:21:09.087Z'
}
[Error Retry Service] 尝试 1 失败: {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：测试错误处理，这个请求应该会因为网络问题失败\\n【产品类型】：web\\n【实现方式】：ai\\n\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 2367,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 2367\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium'
}
[Error Retry Service] 等待 1074.2247027707838ms 后重试...
[Error Retry Service] 执行尝试 2/4
[AI Service] 发起AI调用: {"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\n\n【用户需求】：测试错误处理，这个请求应该会因为网络问题失败\n【产品类型】：...
[AI Service] AI调用失败: aborted
[Error Retry Service] 错误记录: {
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium',
  timestamp: '2025-08-15T10:21:40.388Z'
}
[Error Retry Service] 尝试 2 失败: {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：测试错误处理，这个请求应该会因为网络问题失败\\n【产品类型】：web\\n【实现方式】：ai\\n\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 2367,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 2367\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium'
}
[Error Retry Service] 等待 1820.8986727339088ms 后重试...
[Error Retry Service] 执行尝试 3/4
[AI Service] 发起AI调用: {"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\n\n【用户需求】：测试错误处理，这个请求应该会因为网络问题失败\n【产品类型】：...
[AI Service] AI调用失败: aborted
[Error Retry Service] 错误记录: {
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium',
  timestamp: '2025-08-15T10:22:12.539Z'
}
[Error Retry Service] 尝试 3 失败: {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：测试错误处理，这个请求应该会因为网络问题失败\\n【产品类型】：web\\n【实现方式】：ai\\n\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 2367,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 2367\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium'
}
[Error Retry Service] 等待 4225.299368229875ms 后重试...
[Error Retry Service] 执行尝试 4/4
[AI Service] 发起AI调用: {"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\n\n【用户需求】：测试错误处理，这个请求应该会因为网络问题失败\n【产品类型】：...
📨 POST /api/ai/analyze - 2025-08-15T10:22:32.096Z
[AI Controller] 开始分析需求: {
  requirement: '用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qi权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图...',
  productType: 'desktop',
  implementType: 'ai',
  source: 'text'
}
[AI Service] 开始流程图分析: {
  requirement: '用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qi权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图...',
  productType: 'desktop',
  implementType: 'ai'
}
[AI Service] Prompt组装完成，长度: 1126
[Error Retry Service] 执行尝试 1/4
[AI Service] 发起AI调用: {"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\n\n【用户需求】：用户在wps office的pc客户端，打开一个pdf文档，点...
[AI Service] AI调用失败: aborted
[Error Retry Service] 错误记录: {
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium',
  timestamp: '2025-08-15T10:22:47.075Z'
}
[Error Retry Service] 尝试 4 失败: {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：测试错误处理，这个请求应该会因为网络问题失败\\n【产品类型】：web\\n【实现方式】：ai\\n\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 2367,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 2367\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium'
}
[Error Retry Service] 不再重试，原因: 超过最大重试次数
[AI Service] 流程图分析失败: Error: 网络连接失败，请检查网络连接后重试
    at ErrorRetryService.enhanceError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:231:27)
    at ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:89:16)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
    at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
    at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：测试错误处理，这个请求应该会因为网络问题失败\\n【产品类型】：web\\n【实现方式】：ai\\n\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 2367,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 2367\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  errorType: 'network_error',
  attempts: 4,
  retryable: true,
  severity: 'medium'
}
[AI Controller] 需求分析失败: Error: 网络连接失败，请检查网络连接后重试
    at ErrorRetryService.enhanceError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:231:27)
    at ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:89:16)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
    at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
    at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：测试错误处理，这个请求应该会因为网络问题失败\\n【产品类型】：web\\n【实现方式】：ai\\n\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 2367,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 2367\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  errorType: 'network_error',
  attempts: 4,
  retryable: true,
  severity: 'medium'
}
[AI Controller] 请求失败，耗时: 128311ms
[AI Service] AI调用失败: aborted
[Error Retry Service] 错误记录: {
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium',
  timestamp: '2025-08-15T10:23:02.283Z'
}
[Error Retry Service] 尝试 1 失败: {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qi权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图\\n【产品类型】：desktop - 本地文件处理、系统集成、离线能力\\n【实现方式】：ai\\n【技术考虑】：文件格式兼容性、本地缓存策略、系统权限获取、网络连接处理、多窗口协调\\n\\n【业务场景参考】：\\n核心流程应包含：文档打开与解析 → 翻译服务选择与配置 → 内容提取与预处理 → AI翻译调用与结果处理 → 译文展示与对比 → 用户编辑与确认 → 保存与导出\\n商业逻辑要点：会员权益验证（免费用户限制）、翻译质量等级选择、计费逻辑（按页数/字数）、翻译历史记录、协作与分享功能\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 3157,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 3157\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium'
}
[Error Retry Service] 等待 1070.223858636054ms 后重试...
[Error Retry Service] 执行尝试 2/4
[AI Service] 发起AI调用: {"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\n\n【用户需求】：用户在wps office的pc客户端，打开一个pdf文档，点...
[AI Service] AI调用失败: aborted
[Error Retry Service] 错误记录: {
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium',
  timestamp: '2025-08-15T10:23:33.554Z'
}
[Error Retry Service] 尝试 2 失败: {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qi权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图\\n【产品类型】：desktop - 本地文件处理、系统集成、离线能力\\n【实现方式】：ai\\n【技术考虑】：文件格式兼容性、本地缓存策略、系统权限获取、网络连接处理、多窗口协调\\n\\n【业务场景参考】：\\n核心流程应包含：文档打开与解析 → 翻译服务选择与配置 → 内容提取与预处理 → AI翻译调用与结果处理 → 译文展示与对比 → 用户编辑与确认 → 保存与导出\\n商业逻辑要点：会员权益验证（免费用户限制）、翻译质量等级选择、计费逻辑（按页数/字数）、翻译历史记录、协作与分享功能\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 3157,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 3157\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium'
}
[Error Retry Service] 等待 2022.418814830155ms 后重试...
[Error Retry Service] 执行尝试 3/4
[AI Service] 发起AI调用: {"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\n\n【用户需求】：用户在wps office的pc客户端，打开一个pdf文档，点...
[AI Service] AI调用失败: aborted
[Error Retry Service] 错误记录: {
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium',
  timestamp: '2025-08-15T10:24:05.802Z'
}
[Error Retry Service] 尝试 3 失败: {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qi权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图\\n【产品类型】：desktop - 本地文件处理、系统集成、离线能力\\n【实现方式】：ai\\n【技术考虑】：文件格式兼容性、本地缓存策略、系统权限获取、网络连接处理、多窗口协调\\n\\n【业务场景参考】：\\n核心流程应包含：文档打开与解析 → 翻译服务选择与配置 → 内容提取与预处理 → AI翻译调用与结果处理 → 译文展示与对比 → 用户编辑与确认 → 保存与导出\\n商业逻辑要点：会员权益验证（免费用户限制）、翻译质量等级选择、计费逻辑（按页数/字数）、翻译历史记录、协作与分享功能\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 3157,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 3157\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium'
}
[Error Retry Service] 等待 4335.685800319558ms 后重试...
[Error Retry Service] 执行尝试 4/4
[AI Service] 发起AI调用: {"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\n\n【用户需求】：用户在wps office的pc客户端，打开一个pdf文档，点...
[AI Service] AI调用失败: aborted
[Error Retry Service] 错误记录: {
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium',
  timestamp: '2025-08-15T10:24:40.359Z'
}
[Error Retry Service] 尝试 4 失败: {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qi权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图\\n【产品类型】：desktop - 本地文件处理、系统集成、离线能力\\n【实现方式】：ai\\n【技术考虑】：文件格式兼容性、本地缓存策略、系统权限获取、网络连接处理、多窗口协调\\n\\n【业务场景参考】：\\n核心流程应包含：文档打开与解析 → 翻译服务选择与配置 → 内容提取与预处理 → AI翻译调用与结果处理 → 译文展示与对比 → 用户编辑与确认 → 保存与导出\\n商业逻辑要点：会员权益验证（免费用户限制）、翻译质量等级选择、计费逻辑（按页数/字数）、翻译历史记录、协作与分享功能\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 3157,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 3157\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium'
}
[Error Retry Service] 不再重试，原因: 超过最大重试次数
[AI Service] 流程图分析失败: Error: 网络连接失败，请检查网络连接后重试
    at ErrorRetryService.enhanceError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:231:27)
    at ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:89:16)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
    at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
    at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qi权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图\\n【产品类型】：desktop - 本地文件处理、系统集成、离线能力\\n【实现方式】：ai\\n【技术考虑】：文件格式兼容性、本地缓存策略、系统权限获取、网络连接处理、多窗口协调\\n\\n【业务场景参考】：\\n核心流程应包含：文档打开与解析 → 翻译服务选择与配置 → 内容提取与预处理 → AI翻译调用与结果处理 → 译文展示与对比 → 用户编辑与确认 → 保存与导出\\n商业逻辑要点：会员权益验证（免费用户限制）、翻译质量等级选择、计费逻辑（按页数/字数）、翻译历史记录、协作与分享功能\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 3157,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 3157\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  errorType: 'network_error',
  attempts: 4,
  retryable: true,
  severity: 'medium'
}
[AI Controller] 需求分析失败: Error: 网络连接失败，请检查网络连接后重试
    at ErrorRetryService.enhanceError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:231:27)
    at ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:89:16)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
    at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
    at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qi权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图\\n【产品类型】：desktop - 本地文件处理、系统集成、离线能力\\n【实现方式】：ai\\n【技术考虑】：文件格式兼容性、本地缓存策略、系统权限获取、网络连接处理、多窗口协调\\n\\n【业务场景参考】：\\n核心流程应包含：文档打开与解析 → 翻译服务选择与配置 → 内容提取与预处理 → AI翻译调用与结果处理 → 译文展示与对比 → 用户编辑与确认 → 保存与导出\\n商业逻辑要点：会员权益验证（免费用户限制）、翻译质量等级选择、计费逻辑（按页数/字数）、翻译历史记录、协作与分享功能\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 3157,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 3157\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  errorType: 'network_error',
  attempts: 4,
  retryable: true,
  severity: 'medium'
}
[AI Controller] 请求失败，耗时: 128272ms
::1 - - [15/Aug/2025:10:24:40 +0000] "POST /api/ai/analyze HTTP/1.1" 500 259 "http://localhost:5173/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36"
📤 POST /analyze 🔴 500 - 128280ms
📨 POST /api/ai/analyze - 2025-08-16T06:56:32.828Z
[AI Controller] 开始分析需求: {
  requirement: '\n' +
    '用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qi权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图...',
  productType: 'desktop',
  implementType: 'ai',
  source: 'text'
}
[AI Service] 开始流程图分析: {
  requirement: '\n' +
    '用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qi权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图...',
  productType: 'desktop',
  implementType: 'ai'
}
[AI Service] Prompt组装完成，长度: 1127
[Error Retry Service] 执行尝试 1/4
[AI Service] 发起AI调用: {"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\n\n【用户需求】：\n用户在wps office的pc客户端，打开一个pdf文档...
[AI Service] AI调用失败: aborted
[Error Retry Service] 错误记录: {
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium',
  timestamp: '2025-08-16T06:57:03.068Z'
}
[Error Retry Service] 尝试 1 失败: {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：\\n用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qi权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图\\n【产品类型】：desktop - 本地文件处理、系统集成、离线能力\\n【实现方式】：ai\\n【技术考虑】：文件格式兼容性、本地缓存策略、系统权限获取、网络连接处理、多窗口协调\\n\\n【业务场景参考】：\\n核心流程应包含：文档打开与解析 → 翻译服务选择与配置 → 内容提取与预处理 → AI翻译调用与结果处理 → 译文展示与对比 → 用户编辑与确认 → 保存与导出\\n商业逻辑要点：会员权益验证（免费用户限制）、翻译质量等级选择、计费逻辑（按页数/字数）、翻译历史记录、协作与分享功能\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 3159,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 3159\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium'
}
[Error Retry Service] 等待 1024.2732519413282ms 后重试...
[Error Retry Service] 执行尝试 2/4
[AI Service] 发起AI调用: {"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\n\n【用户需求】：\n用户在wps office的pc客户端，打开一个pdf文档...
[AI Service] AI调用失败: aborted
[Error Retry Service] 错误记录: {
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium',
  timestamp: '2025-08-16T06:57:34.296Z'
}
[Error Retry Service] 尝试 2 失败: {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：\\n用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qi权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图\\n【产品类型】：desktop - 本地文件处理、系统集成、离线能力\\n【实现方式】：ai\\n【技术考虑】：文件格式兼容性、本地缓存策略、系统权限获取、网络连接处理、多窗口协调\\n\\n【业务场景参考】：\\n核心流程应包含：文档打开与解析 → 翻译服务选择与配置 → 内容提取与预处理 → AI翻译调用与结果处理 → 译文展示与对比 → 用户编辑与确认 → 保存与导出\\n商业逻辑要点：会员权益验证（免费用户限制）、翻译质量等级选择、计费逻辑（按页数/字数）、翻译历史记录、协作与分享功能\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 3159,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 3159\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium'
}
[Error Retry Service] 等待 1857.3801191084617ms 后重试...
[Error Retry Service] 执行尝试 3/4
[AI Service] 发起AI调用: {"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\n\n【用户需求】：\n用户在wps office的pc客户端，打开一个pdf文档...
[AI Service] AI调用失败: aborted
[Error Retry Service] 错误记录: {
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium',
  timestamp: '2025-08-16T06:58:06.363Z'
}
[Error Retry Service] 尝试 3 失败: {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：\\n用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qi权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图\\n【产品类型】：desktop - 本地文件处理、系统集成、离线能力\\n【实现方式】：ai\\n【技术考虑】：文件格式兼容性、本地缓存策略、系统权限获取、网络连接处理、多窗口协调\\n\\n【业务场景参考】：\\n核心流程应包含：文档打开与解析 → 翻译服务选择与配置 → 内容提取与预处理 → AI翻译调用与结果处理 → 译文展示与对比 → 用户编辑与确认 → 保存与导出\\n商业逻辑要点：会员权益验证（免费用户限制）、翻译质量等级选择、计费逻辑（按页数/字数）、翻译历史记录、协作与分享功能\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 3159,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 3159\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium'
}
[Error Retry Service] 等待 4353.5011569831ms 后重试...
[Error Retry Service] 执行尝试 4/4
[AI Service] 发起AI调用: {"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\n\n【用户需求】：\n用户在wps office的pc客户端，打开一个pdf文档...
[AI Service] AI调用失败: aborted
[Error Retry Service] 错误记录: {
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium',
  timestamp: '2025-08-16T06:58:40.923Z'
}
[Error Retry Service] 尝试 4 失败: {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：\\n用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qi权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图\\n【产品类型】：desktop - 本地文件处理、系统集成、离线能力\\n【实现方式】：ai\\n【技术考虑】：文件格式兼容性、本地缓存策略、系统权限获取、网络连接处理、多窗口协调\\n\\n【业务场景参考】：\\n核心流程应包含：文档打开与解析 → 翻译服务选择与配置 → 内容提取与预处理 → AI翻译调用与结果处理 → 译文展示与对比 → 用户编辑与确认 → 保存与导出\\n商业逻辑要点：会员权益验证（免费用户限制）、翻译质量等级选择、计费逻辑（按页数/字数）、翻译历史记录、协作与分享功能\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 3159,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 3159\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium'
}
[Error Retry Service] 不再重试，原因: 超过最大重试次数
[AI Service] 流程图分析失败: Error: 网络连接失败，请检查网络连接后重试
    at ErrorRetryService.enhanceError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:231:27)
    at ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:89:16)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
    at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
    at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：\\n用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qi权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图\\n【产品类型】：desktop - 本地文件处理、系统集成、离线能力\\n【实现方式】：ai\\n【技术考虑】：文件格式兼容性、本地缓存策略、系统权限获取、网络连接处理、多窗口协调\\n\\n【业务场景参考】：\\n核心流程应包含：文档打开与解析 → 翻译服务选择与配置 → 内容提取与预处理 → AI翻译调用与结果处理 → 译文展示与对比 → 用户编辑与确认 → 保存与导出\\n商业逻辑要点：会员权益验证（免费用户限制）、翻译质量等级选择、计费逻辑（按页数/字数）、翻译历史记录、协作与分享功能\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 3159,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 3159\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  errorType: 'network_error',
  attempts: 4,
  retryable: true,
  severity: 'medium'
}
[AI Controller] 需求分析失败: Error: 网络连接失败，请检查网络连接后重试
    at ErrorRetryService.enhanceError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:231:27)
    at ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:89:16)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
    at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
    at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：\\n用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qi权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图\\n【产品类型】：desktop - 本地文件处理、系统集成、离线能力\\n【实现方式】：ai\\n【技术考虑】：文件格式兼容性、本地缓存策略、系统权限获取、网络连接处理、多窗口协调\\n\\n【业务场景参考】：\\n核心流程应包含：文档打开与解析 → 翻译服务选择与配置 → 内容提取与预处理 → AI翻译调用与结果处理 → 译文展示与对比 → 用户编辑与确认 → 保存与导出\\n商业逻辑要点：会员权益验证（免费用户限制）、翻译质量等级选择、计费逻辑（按页数/字数）、翻译历史记录、协作与分享功能\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 3159,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 3159\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  errorType: 'network_error',
  attempts: 4,
  retryable: true,
  severity: 'medium'
}
[AI Controller] 请求失败，耗时: 128098ms
::1 - - [16/Aug/2025:06:58:40 +0000] "POST /api/ai/analyze HTTP/1.1" 500 259 "http://localhost:5173/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36"
📤 POST /analyze 🔴 500 - 128104ms
📨 GET /health - 2025-08-16T07:00:45.639Z
::1 - - [16/Aug/2025:07:00:45 +0000] "GET /health HTTP/1.1" 200 100 "-" "curl/8.6.0"
📤 GET /health 🟢 200 - 3ms
📨 POST /api/ai/analyze - 2025-08-16T07:00:48.625Z
::1 - - [16/Aug/2025:07:00:48 +0000] "POST /api/ai/analyze HTTP/1.1" 400 97 "-" "curl/8.6.0"
📤 POST /analyze 🔴 400 - 3ms
📨 POST /api/ai/analyze - 2025-08-16T07:00:56.782Z
[AI Controller] 开始分析需求: {
  requirement: '用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qj权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图...',
  productType: 'desktop',
  implementType: 'ai',
  source: 'text'
}
[AI Service] 开始流程图分析: {
  requirement: '用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qj权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图...',
  productType: 'desktop',
  implementType: 'ai'
}
[AI Service] Prompt组装完成，长度: 1126
[Error Retry Service] 执行尝试 1/4
[AI Service] 发起AI调用: {"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\n\n【用户需求】：用户在wps office的pc客户端，打开一个pdf文档，点...
[AI Service] AI调用失败: aborted
[Error Retry Service] 错误记录: {
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium',
  timestamp: '2025-08-16T07:01:26.984Z'
}
[Error Retry Service] 尝试 1 失败: {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qj权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图\\n【产品类型】：desktop - 本地文件处理、系统集成、离线能力\\n【实现方式】：ai\\n【技术考虑】：文件格式兼容性、本地缓存策略、系统权限获取、网络连接处理、多窗口协调\\n\\n【业务场景参考】：\\n核心流程应包含：文档打开与解析 → 翻译服务选择与配置 → 内容提取与预处理 → AI翻译调用与结果处理 → 译文展示与对比 → 用户编辑与确认 → 保存与导出\\n商业逻辑要点：会员权益验证（免费用户限制）、翻译质量等级选择、计费逻辑（按页数/字数）、翻译历史记录、协作与分享功能\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 3157,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 3157\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium'
}
[Error Retry Service] 等待 1056.6075352787193ms 后重试...
[Error Retry Service] 执行尝试 2/4
[AI Service] 发起AI调用: {"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\n\n【用户需求】：用户在wps office的pc客户端，打开一个pdf文档，点...
::1 - - [16/Aug/2025:07:01:43 +0000] "POST /api/ai/analyze HTTP/1.1" - - "-" "curl/8.6.0"
[AI Service] AI调用失败: aborted
[Error Retry Service] 错误记录: {
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium',
  timestamp: '2025-08-16T07:01:58.244Z'
}
[Error Retry Service] 尝试 2 失败: {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qj权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图\\n【产品类型】：desktop - 本地文件处理、系统集成、离线能力\\n【实现方式】：ai\\n【技术考虑】：文件格式兼容性、本地缓存策略、系统权限获取、网络连接处理、多窗口协调\\n\\n【业务场景参考】：\\n核心流程应包含：文档打开与解析 → 翻译服务选择与配置 → 内容提取与预处理 → AI翻译调用与结果处理 → 译文展示与对比 → 用户编辑与确认 → 保存与导出\\n商业逻辑要点：会员权益验证（免费用户限制）、翻译质量等级选择、计费逻辑（按页数/字数）、翻译历史记录、协作与分享功能\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 3157,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 3157\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium'
}
[Error Retry Service] 等待 2181.3648129763683ms 后重试...
[Error Retry Service] 执行尝试 3/4
[AI Service] 发起AI调用: {"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\n\n【用户需求】：用户在wps office的pc客户端，打开一个pdf文档，点...
📨 GET /api/ai/health - 2025-08-16T07:02:15.489Z
[AI Service] 发起AI调用: No data...
[AI Service] AI调用成功: 200
::1 - - [16/Aug/2025:07:02:15 +0000] "GET /api/ai/health HTTP/1.1" 200 112 "-" "curl/8.6.0"
📤 GET /health 🟢 200 - 230ms
[AI Service] AI调用失败: aborted
[Error Retry Service] 错误记录: {
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium',
  timestamp: '2025-08-16T07:02:30.644Z'
}
[Error Retry Service] 尝试 3 失败: {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qj权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图\\n【产品类型】：desktop - 本地文件处理、系统集成、离线能力\\n【实现方式】：ai\\n【技术考虑】：文件格式兼容性、本地缓存策略、系统权限获取、网络连接处理、多窗口协调\\n\\n【业务场景参考】：\\n核心流程应包含：文档打开与解析 → 翻译服务选择与配置 → 内容提取与预处理 → AI翻译调用与结果处理 → 译文展示与对比 → 用户编辑与确认 → 保存与导出\\n商业逻辑要点：会员权益验证（免费用户限制）、翻译质量等级选择、计费逻辑（按页数/字数）、翻译历史记录、协作与分享功能\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 3157,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 3157\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium'
}
[Error Retry Service] 等待 3845.2863164626438ms 后重试...
[Error Retry Service] 执行尝试 4/4
[AI Service] 发起AI调用: {"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\n\n【用户需求】：用户在wps office的pc客户端，打开一个pdf文档，点...
[AI Service] AI调用失败: aborted
[Error Retry Service] 错误记录: {
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium',
  timestamp: '2025-08-16T07:03:04.684Z'
}
[Error Retry Service] 尝试 4 失败: {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qj权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图\\n【产品类型】：desktop - 本地文件处理、系统集成、离线能力\\n【实现方式】：ai\\n【技术考虑】：文件格式兼容性、本地缓存策略、系统权限获取、网络连接处理、多窗口协调\\n\\n【业务场景参考】：\\n核心流程应包含：文档打开与解析 → 翻译服务选择与配置 → 内容提取与预处理 → AI翻译调用与结果处理 → 译文展示与对比 → 用户编辑与确认 → 保存与导出\\n商业逻辑要点：会员权益验证（免费用户限制）、翻译质量等级选择、计费逻辑（按页数/字数）、翻译历史记录、协作与分享功能\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 3157,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 3157\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  type: 'network_error',
  message: 'aborted',
  code: 'ECONNRESET',
  statusCode: undefined,
  retryable: true,
  severity: 'medium'
}
[Error Retry Service] 不再重试，原因: 超过最大重试次数
[AI Service] 流程图分析失败: Error: 网络连接失败，请检查网络连接后重试
    at ErrorRetryService.enhanceError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:231:27)
    at ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:89:16)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
    at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
    at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qj权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图\\n【产品类型】：desktop - 本地文件处理、系统集成、离线能力\\n【实现方式】：ai\\n【技术考虑】：文件格式兼容性、本地缓存策略、系统权限获取、网络连接处理、多窗口协调\\n\\n【业务场景参考】：\\n核心流程应包含：文档打开与解析 → 翻译服务选择与配置 → 内容提取与预处理 → AI翻译调用与结果处理 → 译文展示与对比 → 用户编辑与确认 → 保存与导出\\n商业逻辑要点：会员权益验证（免费用户限制）、翻译质量等级选择、计费逻辑（按页数/字数）、翻译历史记录、协作与分享功能\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 3157,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 3157\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  errorType: 'network_error',
  attempts: 4,
  retryable: true,
  severity: 'medium'
}
[AI Controller] 需求分析失败: Error: 网络连接失败，请检查网络连接后重试
    at ErrorRetryService.enhanceError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:231:27)
    at ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:89:16)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
    at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
    at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
  originalError: AxiosError: aborted
      at AxiosError.from (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/AxiosError.js:92:14)
      at Unzip.handleStreamError (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/adapters/http.js:583:29)
      at Unzip.emit (node:events:519:35)
      at emitErrorNT (node:internal/streams/destroy:170:8)
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)
      at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
      at Axios.request (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/node_modules/axios/lib/core/Axios.js:45:41)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async errorRetryService.executeWithRetry.maxRetries (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:189:24)
      at async ErrorRetryService.executeWithRetry (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/errorRetryService.js:58:24)
      at async AIService.generateText (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:173:12)
      at async AIService.analyzeFlowchart (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/services/aiService.js:248:22)
      at async analyzeRequirement (file:///Users/sunnyzx-wps/Documents/ai_tools/ai_to_md/backend/src/controllers/aiController.js:112:24) {
    code: 'ECONNRESET',
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 30000,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      baseURL: 'https://api.deepseek.com/v1',
      method: 'post',
      url: '/chat/completions',
      data: `{"model":"deepseek-chat","messages":[{"role":"user","content":"你是资深的产品架构师和业务流程专家。你的任务是基于用户的简单需求描述，主动进行深度业务分析，推断出完整的业务流程，并生成专业的流程图。你要成为用户的业务分析助手，而不是要求用户提供所有细节。\\n\\n【用户需求】：用户在wps office的pc客户端，打开一个pdf文档，点击导航上的ai全文对照翻译入口，判断用户登录态，登录后，判断用户qj权益，使用全文翻译功能，请输出这个全文翻译功能的使用和商业化的流程图\\n【产品类型】：desktop - 本地文件处理、系统集成、离线能力\\n【实现方式】：ai\\n【技术考虑】：文件格式兼容性、本地缓存策略、系统权限获取、网络连接处理、多窗口协调\\n\\n【业务场景参考】：\\n核心流程应包含：文档打开与解析 → 翻译服务选择与配置 → 内容提取与预处理 → AI翻译调用与结果处理 → 译文展示与对比 → 用户编辑与确认 → 保存与导出\\n商业逻辑要点：会员权益验证（免费用户限制）、翻译质量等级选择、计费逻辑（按页数/字数）、翻译历史记录、协作与分享功能\\n\\n【智能分析任务】：\\n你需要基于以上简单需求描述，主动进行深度业务分析：\\n\\n1. **场景理解**：深入理解业务场景，识别关键角色、核心功能和使用环境\\n2. **流程推断**：基于行业经验和产品逻辑，推断出完整的业务流程  \\n3. **关键节点识别**：识别权限验证、付费节点、AI调用、异常处理等关键业务节点\\n4. **商业逻辑分析**：分析商业化机会、用户付费意愿、会员权益等商业逻辑\\n5. **用户体验优化**：考虑用户操作便利性、反馈及时性、错误恢复等体验要素\\n\\n【输出要求】：\\n• 体现具体业务场景的真实流程，不是通用模板\\n• 包含关键的商业化节点和用户决策点\\n• 显示具体的功能模块和数据流转\\n• 体现用户的实际操作路径和选择\\n• 包含有意义的异常处理和降级方案\\n• 节点命名要具体，避免'处理'、'验证'等通用词汇\\n• 使用标准Mermaid flowchart TD语法，确保可渲染\\n\\n【质量标准】：\\n• 流程图必须对产品经理有实际指导价值\\n• 能够帮助开发团队理解业务逻辑\\n• 体现真实的用户使用场景和痛点\\n• 包含可执行的商业化策略建议\\n• 避免空洞的通用流程模板\\n\\n【重要提醒】：\\n针对WPS翻译功能，应该生成类似这样的具体流程：用户打开PDF → 点击翻译按钮 → 检查会员权限（免费用户每日5页限制）→ 选择翻译语言和质量 → 提取文档内容 → 调用翻译API → 显示对照翻译结果 → 用户确认修改 → 保存/导出，而不是通用的'开始→分析→处理→结束'模板。\\n\\n请基于以上分析，生成具有实际业务价值的专业流程图，使用标准Mermaid语法。"}],"temperature":0.3,"max_tokens":4000,"top_p":0.9,"stream":false}`,
      allowAbsoluteUrls: true
    },
    request: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: true,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: 3157,
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: true,
      _header: 'POST /v1/chat/completions HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'Authorization: Bearer sk-894ae1e978ce45239084604440efd1f5\r\n' +
        'HTTP-Referer: http://localhost:3001\r\n' +
        'User-Agent: axios/1.11.0\r\n' +
        'Content-Length: 3157\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: api.deepseek.com\r\n' +
        'Connection: keep-alive\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/v1/chat/completions',
      _ended: false,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api.deepseek.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kChunkedBuffer)]: [],
      [Symbol(kChunkedLength)]: 0,
      [Symbol(kSocket)]: [TLSSocket],
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 65536,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    cause: Error: aborted
        at TLSSocket.socketCloseListener (node:_http_client:478:19)
        at TLSSocket.emit (node:events:519:35)
        at node:net:351:12
        at TCP.done (node:_tls_wrap:650:7) {
      code: 'ECONNRESET'
    }
  },
  errorType: 'network_error',
  attempts: 4,
  retryable: true,
  severity: 'medium'
}
[AI Controller] 请求失败，耗时: 127903ms
